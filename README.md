# Learning Rust

>   [Rust](https://www.rust-lang.org/zh-CN/) å­¦ä¹ ç¬”è®°åŠç¤ºä¾‹ä»£ç ï¼Œä¸»è¦æ˜¯å¯¹ [ã€ŠRust ç¨‹åºè®¾è®¡è¯­è¨€ã€‹](https://kaisery.gitbooks.io/rust-book-chinese/content/) *ï¼ˆç¬¬ä¸€ç‰ˆï¼‰ ç®€ä½“ä¸­æ–‡ç‰ˆ* æ•™ç¨‹è¿›è¡Œå­¦ä¹ ç¬”è®°æ‘˜è¦ã€‚ç¬”è€…æ‰€è¿è¡Œçš„çŽ¯å¢ƒä¸º `macOS` ï¼Œæ–‡æ¡£åŠç¤ºä¾‹ä»£ç å¦‚æžœä¸åšç‰¹æ®Šè¯´æ˜Žå‡åœ¨æ­¤çŽ¯å¢ƒæè¿°æˆ–è¿è¡Œã€‚

>   å…¶å®ƒä¼˜ç§€èµ„æºï¼š[A Gentle Introduction To Rust](https://stevedonovan.github.io/rust-gentle-intro/readme.html) (è‹±æ–‡åŽŸç‰ˆ)ã€‚

## 1. ä»‹ç»

>   Rust æ˜¯ä¸€ä¸ªç³»ç»Ÿç¼–ç¨‹è¯­è¨€ï¼Œå®ƒæ³¨é‡äºŽä¸‰ä¸ªæ–¹é¢ï¼šå®‰å…¨ï¼Œé€Ÿåº¦å’Œå¹¶å‘æ€§ã€‚ä¸ºäº†å®žçŽ°è¿™äº›ç›®æ ‡ï¼Œå®ƒæ²¡æœ‰é‡‡ç”¨åžƒåœ¾å›žæ”¶æœºåˆ¶ï¼ˆGCï¼‰ã€‚è¿™è®©å®ƒåœ¨å…¶å®ƒè¯­è¨€å¹¶ä¸æ“…é•¿çš„åœºæ™¯ä¸­å¤§å±•èº«æ‰‹ï¼šåµŒå…¥åˆ°å…¶å®ƒè¯­è¨€ä¸­ã€åœ¨ç‰¹å®šçš„æ—¶é—´å’Œç©ºé—´è¦æ±‚ä¸‹ç¼–ç¨‹ã€ç¼–å†™ä¾‹å¦‚è®¾å¤‡é©±åŠ¨å’Œæ“ä½œç³»ç»Ÿè¿™æ ·çš„åº•å±‚ä»£ç ã€‚å®ƒé€šè¿‡ä¸€ç³»åˆ—ä¸äº§ç”Ÿè¿è¡Œæ—¶å¼€é”€çš„ç¼–è¯‘æ—¶å®‰å…¨æ£€æŸ¥æ¥æå‡ç›®å‰è¯­è¨€æ‰€å…³æ³¨çš„é¢†åŸŸï¼ŒåŒæ—¶æ¶ˆé™¤ä¸€åˆ‡æ•°æ®ç«žäº‰ã€‚Rust è¿˜è‡´åŠ›äºŽå®žçŽ°â€œé›¶å¼€é”€æŠ½è±¡â€ï¼Œè™½ç„¶æœ‰äº›æŠ½è±¡çœ‹èµ·æ¥æ›´åƒä¸€ä¸ªé«˜çº§è¯­è¨€çš„ç‰¹æ€§ã€‚å³ä¾¿å¦‚æ­¤ï¼Œä½ ä»ç„¶å¯ä»¥ä½¿ç”¨ Rust æ¥åšä¸€äº›åº•å±‚çš„ç²¾å‡†æŽ§åˆ¶ã€‚

## 2. å‡†å¤‡

### å®‰è£…

å®‰è£… `Rust`ï¼š

```shell
curl https://sh.rustup.rs -sSf | sh
```

### å¸è½½

å¸è½½ `Rust` ï¼š

```shell
rustup self uninstall
```

### ç»ˆç«¯å‘½ä»¤

æŸ¥çœ‹ç¼–è¯‘å™¨ç‰ˆæœ¬ï¼š

```shell
rustc --version
```

### `Hello World` ç¤ºä¾‹

è§ `demo/hello_world/main.rs` [ðŸ“Ž](demo/hello_world/main.rs) ã€‚

```shell
# ç¼–è¯‘
rustc main.rs
# è¿è¡Œ
./main
Hello, world!
```

### è½¬æˆ `Cargo` ç¤ºä¾‹

æŸ¥çœ‹ `cargo` ç‰ˆæœ¬ï¼š

```shell
cargo --version
```

è½¬æ¢æˆ `cargo` ç‰ˆæœ¬è§ [hello_world](hello_world/) ã€‚

```shell
# æž„å»º
cargo build
# è¿è¡Œ
./target/debug/hello_world
# æˆ–è€…è¿è¡Œ
cargo run
# å‘å¸ƒæž„å»º
cargo build --release
# åŸºäºŽ `Cargo` å¼€å§‹ä¸€ä¸ªæ–°é¡¹ç›®
cargo new hello_world --bin
```

## 3. æ•™ç¨‹ï¼šçŒœçŒœçœ‹

>   è¿™é‡Œä¸å†èµ˜è¿°ï¼Œå‚è€ƒåŽŸå§‹æ–‡æ¡£ã€‚ä»£ç è§ [guessing_game](guessing_game/src/main.rs) ã€‚

## 4. è¯­æ³•å’Œè¯­ä¹‰

### 4.1 å˜é‡ç»‘å®š

```rust
let x = 5;
// æ¨¡å¼
let (x, y) = (1, 2);
// ç±»åž‹æ³¨è§£(type annotations)
let x: i32 = 5;
// å¯å˜æ€§
let mut x = 5;
// åˆå§‹åŒ–ç»‘å®š
let x: i32;
```

>   æ³¨æ„ï¼šRust æ˜¯ä¸ä¼šè®©æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªæ²¡æœ‰ç»è¿‡åˆå§‹åŒ–çš„å€¼çš„ã€‚

#### ä½œç”¨åŸŸå’Œéšè—(scope and shadowing)

```rust
fn main() {
    let x: i32 = 17;
    {
        let y: i32 = 3;
        println!("The value of x is {} and value of y is {}", x, y);
    }
    println!("The value of x is {} and value of y is {}", x, y);  // This won't work.
}
```

>   éšè—å’Œå¯å˜ç»‘å®šå¯èƒ½è¡¨çŽ°ä¸ºåŒä¸€æžšç¡¬å¸çš„ä¸¤é¢ï¼Œä»–ä»¬æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µï¼Œä¸èƒ½äº’æ¢ä½¿ç”¨ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œéšè—å…è®¸æˆ‘ä»¬å°†ä¸€ä¸ªåå­—é‡ç»‘å®šä¸ºä¸åŒçš„ç±»åž‹ã€‚å®ƒä¹Ÿå¯ä»¥æ”¹å˜ä¸€ä¸ªç»‘å®šçš„å¯å˜æ€§ã€‚æ³¨æ„éšè—å¹¶ä¸æ”¹å˜å’Œé”€æ¯è¢«ç»‘å®šçš„å€¼ï¼Œè¿™ä¸ªå€¼ä¼šåœ¨ç¦»å¼€ä½œç”¨åŸŸä¹‹å‰ç»§ç»­å­˜åœ¨ï¼Œå³ä¾¿æ— æ³•é€šè¿‡ä»»ä½•æ‰‹æ®µè®¿é—®åˆ°å®ƒã€‚

```rust
fn main() {
    let x: i32 = 8;
    {
        println!("{}", x); // Prints "8".
        let x = 12;
        println!("{}", x); // Prints "12".
    }
    println!("{}", x); // Prints "8".
    let x =  42;
    println!("{}", x); // Prints "42".
}
```

### 4.2 å‡½æ•°

```rust
# mainå…¥å£å‡½æ•°
fn main() {
}
# è‡ªå®šä¹‰å‡½æ•°
fn foo() {
}
# æºå¸¦å‚æ•°
fn print_number(x: i32) {
    println!("x is: {}", x);
}
# ç®­å¤´ é™å®šè¿”å›žç±»åž‹
fn add_one(x: i32) -> i32 {
    x + 1
}
```

#### å‘æ•£å‡½æ•°

Rustæœ‰äº›ç‰¹æ®Šçš„è¯­æ³•å«â€œå‘æ•£å‡½æ•°â€ï¼Œè¿™äº›å‡½æ•°å¹¶ä¸è¿”å›žï¼š

```rust
fn diverges() -> ! {
    panic!("This function never returns!");
}
```

`panic!` æ˜¯ä¸€ä¸ªå®ï¼Œç±»ä¼¼æˆ‘ä»¬å·²ç»è§è¿‡çš„ `println!()` ã€‚ä¸Ž `println!()` ä¸åŒçš„æ˜¯ï¼Œ`panic!()` å¯¼è‡´å½“å‰çš„æ‰§è¡Œçº¿ç¨‹å´©æºƒå¹¶è¿”å›žæŒ‡å®šçš„ä¿¡æ¯ã€‚å› ä¸ºè¿™ä¸ªå‡½æ•°ä¼šå´©æºƒï¼Œæ‰€ä»¥å®ƒä¸ä¼šè¿”å›žï¼Œæ‰€ä»¥å®ƒæ‹¥æœ‰ä¸€ä¸ªç±»åž‹!ï¼Œå®ƒä»£è¡¨â€œå‘æ•£â€ã€‚


å¦‚æžœä½ æƒ³è¦æ›´å¤šä¿¡æ¯ï¼Œä½ å¯ä»¥è®¾å®š `RUST_BACKTRACE` çŽ¯å¢ƒå˜é‡æ¥èŽ·å– `backtrace` ï¼š

```shell
RUST_BACKTRACE=0 ./diverges
RUST_BACKTRACE=1 cargo run
```

å‘æ•£å‡½æ•°å¯ä»¥è¢«ç”¨ä½œä»»ä½•ç±»åž‹ã€‚

#### å‡½æ•°æŒ‡é’ˆ


æˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ›å»ºæŒ‡å‘å‡½æ•°çš„å˜é‡ç»‘å®šï¼š`f` æ˜¯ä¸€ä¸ªæŒ‡å‘ä¸€ä¸ªèŽ·å– `i32` ä½œä¸ºå‚æ•°å¹¶è¿”å›ž `i32` çš„å‡½æ•°çš„å˜é‡ç»‘å®šã€‚

```rust
fn plus_one(i: i32) -> i32 {
    i + 1
}

// without type inference
let f: fn(i32) -> i32 = plus_one;

// with type inference
let f = plus_one;
let six = f(5);
```
